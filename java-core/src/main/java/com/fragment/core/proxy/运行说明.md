# SpringAopProxyDemo 运行说明

## 运行环境
- JDK 1.8

## 运行方式

### 方式1：不使用CGLIB（只演示JDK动态代理）

```bash
cd /Users/huabin/workspace/playground/my-github/java-fragment-code/java-core/src/main/java
javac com/fragment/core/proxy/*.java
java com.fragment.core.proxy.SpringAopProxyDemo
```

**输出说明**：
- 会显示 "CGLIB 可用: false"
- 只会演示 JDK 动态代理部分
- 跳过 CGLIB 相关演示

### 方式2：使用CGLIB（完整演示）

如果需要演示CGLIB部分，需要添加CGLIB依赖。

#### Maven项目

在 `pom.xml` 中添加：

```xml
<dependency>
    <groupId>cglib</groupId>
    <artifactId>cglib</artifactId>
    <version>3.3.0</version>
</dependency>
```

#### 手动添加jar包

1. 下载CGLIB jar包：
   - cglib-3.3.0.jar
   - asm-7.1.jar（CGLIB的依赖）

2. 编译运行：
```bash
javac -cp cglib-3.3.0.jar:asm-7.1.jar com/fragment/core/proxy/*.java
java -cp .:cglib-3.3.0.jar:asm-7.1.jar com.fragment.core.proxy.SpringAopProxyDemo
```

## 演示内容

### 场景1：JDK动态代理（总是可用）
- 演示有接口的类使用JDK动态代理
- 这是Spring 5.x之前的默认行为

### 场景2：CGLIB代理（需要CGLIB依赖）
- 演示无接口的类使用CGLIB代理
- Spring无法使用JDK代理时的选择

### 场景3：强制CGLIB（需要CGLIB依赖）
- 演示即使有接口也使用CGLIB
- 对应Spring Boot 2.x+的默认行为

### 场景4：代理类型检测
- 演示如何判断是JDK代理还是CGLIB代理
- 模拟Spring的AopUtils工具类

## 预期输出

### 不使用CGLIB时：
```
=== Spring AOP 代理选择机制演示 ===

CGLIB 可用: false

【场景1】有接口的类 - JDK 动态代理
Spring 5.x 之前的默认行为

代理类型: com.sun.proxy.$Proxy0
是否为 JDK 代理: true

[JDK Proxy] Before: findById
[JDK Proxy] After: findById
返回结果: User{id=1, name='张三', email='zhangsan@example.com'}

===========================

【提示】CGLIB 未找到，跳过 CGLIB 相关演示
如需使用 CGLIB，请添加依赖：
<dependency>
    <groupId>cglib</groupId>
    <artifactId>cglib</artifactId>
    <version>3.3.0</version>
</dependency>

===========================

【场景4】代理类型检测

=== JDK 代理检测 ===
类名: com.sun.proxy.$Proxy1
简单类名: $Proxy1
是否为 JDK 代理 (Proxy.isProxyClass): true
是否为 CGLIB 代理 (类名包含 $$): false
实现的接口数量: 1
接口列表: UserService
```

### 使用CGLIB时：
会额外显示场景2和场景3的CGLIB代理演示。

## 注意事项

1. **JDK版本**：确保使用JDK 1.8
2. **CGLIB依赖**：CGLIB部分是可选的，不影响JDK代理演示
3. **类路径**：确保所有依赖类都在类路径中
4. **包结构**：保持正确的包结构 `com.fragment.core.proxy`

## 相关文件

- `UserService.java` - 服务接口
- `UserServiceImpl.java` - 服务实现
- `User.java` - 用户实体类
- `SpringAopProxyDemo.java` - 主演示类

## 故障排查

### 问题1：找不到类
```
Error: Could not find or load main class com.fragment.core.proxy.SpringAopProxyDemo
```
**解决**：确保在正确的目录下运行，且包结构正确。

### 问题2：编译错误
```
error: cannot find symbol
```
**解决**：确保所有依赖的类文件都存在并已编译。

### 问题3：CGLIB相关错误
```
ClassNotFoundException: net.sf.cglib.proxy.Enhancer
```
**解决**：这是正常的，程序会自动跳过CGLIB演示。如需使用，请添加CGLIB依赖。
