# ç¬¬ä¸€ç« ï¼šçº¿ç¨‹åŸºç¡€ä¸ç”Ÿå‘½å‘¨æœŸ

## å¼•è¨€

åœ¨æ·±å…¥å­¦ä¹ çº¿ç¨‹åä½œæœºåˆ¶ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆç†è§£çº¿ç¨‹çš„æœ¬è´¨å’Œç”Ÿå‘½å‘¨æœŸã€‚æœ¬ç« å°†ä»¥é—®é¢˜é©±åŠ¨çš„æ–¹å¼ï¼Œå¾ªåºæ¸è¿›åœ°æ­ç¤ºçº¿ç¨‹çš„æ ¸å¿ƒæ¦‚å¿µã€‚

---

## 1. ä¸ºä»€ä¹ˆéœ€è¦çº¿ç¨‹ï¼Ÿ

### 1.1 é—®é¢˜1ï¼šå•çº¿ç¨‹ç¨‹åºçš„å±€é™æ€§æ˜¯ä»€ä¹ˆï¼Ÿ

**åœºæ™¯ï¼šä¸‹è½½æ–‡ä»¶çš„ç¨‹åº**

```java
public class SingleThreadDownload {
    public static void main(String[] args) {
        System.out.println("å¼€å§‹ä¸‹è½½æ–‡ä»¶A...");
        downloadFile("FileA");  // è€—æ—¶10ç§’
        
        System.out.println("å¼€å§‹ä¸‹è½½æ–‡ä»¶B...");
        downloadFile("FileB");  // è€—æ—¶10ç§’
        
        System.out.println("å¼€å§‹ä¸‹è½½æ–‡ä»¶C...");
        downloadFile("FileC");  // è€—æ—¶10ç§’
        
        System.out.println("å…¨éƒ¨ä¸‹è½½å®Œæˆï¼æ€»è€—æ—¶ï¼š30ç§’");
    }
    
    private static void downloadFile(String fileName) {
        // æ¨¡æ‹Ÿä¸‹è½½
        try {
            Thread.sleep(10000);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
}
```

**é—®é¢˜åˆ†æ**ï¼š

1. **ä¸²è¡Œæ‰§è¡Œ**ï¼šå¿…é¡»ç­‰å¾…å‰ä¸€ä¸ªä»»åŠ¡å®Œæˆæ‰èƒ½å¼€å§‹ä¸‹ä¸€ä¸ª
2. **èµ„æºæµªè´¹**ï¼šCPUåœ¨ç­‰å¾…IOæ—¶å¤„äºç©ºé—²çŠ¶æ€
3. **å“åº”ç¼“æ…¢**ï¼šç”¨æˆ·ä½“éªŒå·®ï¼Œæ— æ³•åŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡
4. **æ— æ³•åˆ©ç”¨å¤šæ ¸**ï¼šç°ä»£CPUå¤šæ ¸å¿ƒçš„ä¼˜åŠ¿æ— æ³•å‘æŒ¥

**æ—¶é—´çº¿å›¾**ï¼š

```
å•çº¿ç¨‹æ‰§è¡Œï¼š
æ—¶é—´è½´: 0s----10s----20s----30s
ä»»åŠ¡:   [FileA][FileB][FileC]
æ€»è€—æ—¶: 30ç§’
```

---

### 1.2 é—®é¢˜2ï¼šå¼•å…¥çº¿ç¨‹åæœ‰ä»€ä¹ˆæ”¹å˜ï¼Ÿ

**å¤šçº¿ç¨‹ç‰ˆæœ¬**ï¼š

```java
public class MultiThreadDownload {
    public static void main(String[] args) throws InterruptedException {
        long startTime = System.currentTimeMillis();
        
        // åˆ›å»º3ä¸ªçº¿ç¨‹åŒæ—¶ä¸‹è½½
        Thread t1 = new Thread(() -> downloadFile("FileA"));
        Thread t2 = new Thread(() -> downloadFile("FileB"));
        Thread t3 = new Thread(() -> downloadFile("FileC"));
        
        // å¯åŠ¨æ‰€æœ‰çº¿ç¨‹
        t1.start();
        t2.start();
        t3.start();
        
        // ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆ
        t1.join();
        t2.join();
        t3.join();
        
        long endTime = System.currentTimeMillis();
        System.out.println("å…¨éƒ¨ä¸‹è½½å®Œæˆï¼æ€»è€—æ—¶ï¼š" + (endTime - startTime) / 1000 + "ç§’");
    }
    
    private static void downloadFile(String fileName) {
        System.out.println(Thread.currentThread().getName() + " å¼€å§‹ä¸‹è½½ " + fileName);
        try {
            Thread.sleep(10000);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        System.out.println(Thread.currentThread().getName() + " å®Œæˆä¸‹è½½ " + fileName);
    }
}
```

**æ—¶é—´çº¿å›¾**ï¼š

```
å¤šçº¿ç¨‹æ‰§è¡Œï¼š
æ—¶é—´è½´: 0s----10s
çº¿ç¨‹1:  [FileA]
çº¿ç¨‹2:  [FileB]
çº¿ç¨‹3:  [FileC]
æ€»è€—æ—¶: 10ç§’ï¼ˆæå‡3å€ï¼ï¼‰
```

**æ ¸å¿ƒæ”¹å˜**ï¼š

1. âœ… **å¹¶å‘æ‰§è¡Œ**ï¼šå¤šä¸ªä»»åŠ¡åŒæ—¶è¿›è¡Œ
2. âœ… **èµ„æºåˆ©ç”¨**ï¼šå……åˆ†åˆ©ç”¨CPUå’ŒIOèµ„æº
3. âœ… **å“åº”æå‡**ï¼šç”¨æˆ·ä½“éªŒæ˜¾è‘—æ”¹å–„
4. âœ… **å¤šæ ¸åˆ©ç”¨**ï¼šå‘æŒ¥å¤šæ ¸CPUçš„ä¼˜åŠ¿

---

### 1.3 é—®é¢˜3ï¼šè¿›ç¨‹ vs çº¿ç¨‹ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**æ¦‚å¿µå¯¹æ¯”**ï¼š

| ç»´åº¦ | è¿›ç¨‹ï¼ˆProcessï¼‰ | çº¿ç¨‹ï¼ˆThreadï¼‰ |
|------|----------------|---------------|
| **å®šä¹‰** | èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ | CPUè°ƒåº¦çš„åŸºæœ¬å•ä½ |
| **èµ„æº** | ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ | å…±äº«è¿›ç¨‹çš„å†…å­˜ç©ºé—´ |
| **å¼€é”€** | åˆ›å»ºå’Œåˆ‡æ¢å¼€é”€å¤§ | åˆ›å»ºå’Œåˆ‡æ¢å¼€é”€å° |
| **é€šä¿¡** | è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰å¤æ‚ | çº¿ç¨‹é—´é€šä¿¡ç®€å•ï¼ˆå…±äº«å†…å­˜ï¼‰ |
| **éš”ç¦»æ€§** | å¼ºéš”ç¦»ï¼Œä¸€ä¸ªè¿›ç¨‹å´©æºƒä¸å½±å“å…¶ä»– | å¼±éš”ç¦»ï¼Œä¸€ä¸ªçº¿ç¨‹å´©æºƒå¯èƒ½å½±å“æ•´ä¸ªè¿›ç¨‹ |
| **æ•°é‡** | ç³»ç»Ÿä¸­è¿›ç¨‹æ•°é‡æœ‰é™ | ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ |

**å†…å­˜ç»“æ„å¯¹æ¯”**ï¼š

```
è¿›ç¨‹æ¨¡å‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¿›ç¨‹A      â”‚  â”‚  è¿›ç¨‹B      â”‚  â”‚  è¿›ç¨‹C      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ä»£ç   â”‚  â”‚  â”‚  â”‚ ä»£ç   â”‚  â”‚  â”‚  â”‚ ä»£ç   â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ æ•°æ®  â”‚  â”‚  â”‚  â”‚ æ•°æ®  â”‚  â”‚  â”‚  â”‚ æ•°æ®  â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ å †    â”‚  â”‚  â”‚  â”‚ å †    â”‚  â”‚  â”‚  â”‚ å †    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   ç‹¬ç«‹å†…å­˜ç©ºé—´      ç‹¬ç«‹å†…å­˜ç©ºé—´      ç‹¬ç«‹å†…å­˜ç©ºé—´

çº¿ç¨‹æ¨¡å‹ï¼ˆåŒä¸€è¿›ç¨‹å†…ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           è¿›ç¨‹                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  å…±äº«åŒºåŸŸ                   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”        â”‚  â”‚
â”‚  â”‚  â”‚ ä»£ç  â”‚  â”‚ æ•°æ® â”‚        â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚       å †ï¼ˆå…±äº«ï¼‰      â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                   â”‚
â”‚  çº¿ç¨‹1      çº¿ç¨‹2      çº¿ç¨‹3      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”       â”‚
â”‚  â”‚æ ˆ  â”‚   â”‚æ ˆ  â”‚   â”‚æ ˆ  â”‚       â”‚
â”‚  â”‚PC  â”‚   â”‚PC  â”‚   â”‚PC  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”˜       â”‚
â”‚  (ç‹¬ç«‹)    (ç‹¬ç«‹)    (ç‹¬ç«‹)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®ç†è§£**ï¼š

- **å…±äº«**ï¼šä»£ç æ®µã€æ•°æ®æ®µã€å †ã€æ‰“å¼€çš„æ–‡ä»¶
- **ç‹¬ç«‹**ï¼šæ ˆã€ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰ã€å¯„å­˜å™¨

---

## 2. çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ

### 2.1 é—®é¢˜4ï¼šçº¿ç¨‹æœ‰å“ªäº›çŠ¶æ€ï¼Ÿ

**Javaçº¿ç¨‹çš„6ç§çŠ¶æ€**ï¼ˆå®šä¹‰åœ¨`Thread.State`æšä¸¾ä¸­ï¼‰ï¼š

```java
public enum State {
    NEW,           // æ–°å»º
    RUNNABLE,      // å¯è¿è¡Œ
    BLOCKED,       // é˜»å¡
    WAITING,       // ç­‰å¾…
    TIMED_WAITING, // è¶…æ—¶ç­‰å¾…
    TERMINATED     // ç»ˆæ­¢
}
```

**çŠ¶æ€è¯¦è§£**ï¼š

#### 1. NEWï¼ˆæ–°å»ºï¼‰

```java
Thread thread = new Thread(() -> {
    System.out.println("Hello");
});
// æ­¤æ—¶çº¿ç¨‹å¤„äºNEWçŠ¶æ€
System.out.println(thread.getState()); // NEW
```

**ç‰¹ç‚¹**ï¼š
- çº¿ç¨‹å¯¹è±¡å·²åˆ›å»ºï¼Œä½†è¿˜æœªè°ƒç”¨`start()`
- å°šæœªåˆ†é…ç³»ç»Ÿèµ„æº
- ä¸ä¼šè¢«CPUè°ƒåº¦

---

#### 2. RUNNABLEï¼ˆå¯è¿è¡Œï¼‰

```java
thread.start();
// æ­¤æ—¶çº¿ç¨‹å¤„äºRUNNABLEçŠ¶æ€
System.out.println(thread.getState()); // RUNNABLE
```

**ç‰¹ç‚¹**ï¼š
- è°ƒç”¨`start()`åè¿›å…¥æ­¤çŠ¶æ€
- **åŒ…å«ä¸¤ä¸ªå­çŠ¶æ€**ï¼š
  - **Readyï¼ˆå°±ç»ªï¼‰**ï¼šç­‰å¾…CPUè°ƒåº¦
  - **Runningï¼ˆè¿è¡Œä¸­ï¼‰**ï¼šæ­£åœ¨CPUä¸Šæ‰§è¡Œ

**é‡è¦**ï¼šJavaæ²¡æœ‰åŒºåˆ†Readyå’ŒRunningï¼Œç»Ÿä¸€ä¸ºRUNNABLEï¼

**ä¸ºä»€ä¹ˆï¼Ÿ**
- çº¿ç¨‹è°ƒåº¦ç”±æ“ä½œç³»ç»Ÿæ§åˆ¶ï¼ŒJavaæ— æ³•ç²¾ç¡®çŸ¥é“çº¿ç¨‹æ˜¯å¦åœ¨CPUä¸Šè¿è¡Œ
- ç®€åŒ–äº†çŠ¶æ€æ¨¡å‹

---

#### 3. BLOCKEDï¼ˆé˜»å¡ï¼‰

```java
public class BlockedExample {
    private static final Object lock = new Object();
    
    public static void main(String[] args) throws InterruptedException {
        Thread t1 = new Thread(() -> {
            synchronized (lock) {
                try {
                    Thread.sleep(5000); // æŒæœ‰é”5ç§’
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        });
        
        Thread t2 = new Thread(() -> {
            synchronized (lock) { // å°è¯•è·å–é”ï¼Œè¿›å…¥BLOCKEDçŠ¶æ€
                System.out.println("t2è·å¾—é”");
            }
        });
        
        t1.start();
        Thread.sleep(100); // ç¡®ä¿t1å…ˆè·å¾—é”
        t2.start();
        Thread.sleep(100);
        
        System.out.println("t2çŠ¶æ€: " + t2.getState()); // BLOCKED
    }
}
```

**ç‰¹ç‚¹**ï¼š
- ç­‰å¾…è·å–`synchronized`é”
- è¢«åŠ¨ç­‰å¾…ï¼Œæ— æ³•ä¸»åŠ¨é€€å‡º
- è·å¾—é”åè‡ªåŠ¨è¿›å…¥RUNNABLE

---

#### 4. WAITINGï¼ˆç­‰å¾…ï¼‰

```java
public class WaitingExample {
    private static final Object lock = new Object();
    
    public static void main(String[] args) throws InterruptedException {
        Thread t1 = new Thread(() -> {
            synchronized (lock) {
                try {
                    lock.wait(); // è¿›å…¥WAITINGçŠ¶æ€
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        });
        
        t1.start();
        Thread.sleep(100);
        
        System.out.println("t1çŠ¶æ€: " + t1.getState()); // WAITING
    }
}
```

**è¿›å…¥WAITINGçš„3ç§æ–¹å¼**ï¼š

1. **Object.wait()**ï¼šé‡Šæ”¾é”ï¼Œç­‰å¾…notify/notifyAll
2. **Thread.join()**ï¼šç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹ç»“æŸ
3. **LockSupport.park()**ï¼šæš‚åœå½“å‰çº¿ç¨‹

**ç‰¹ç‚¹**ï¼š
- ä¸»åŠ¨ç­‰å¾…ï¼Œéœ€è¦å…¶ä»–çº¿ç¨‹å”¤é†’
- ä¸å ç”¨CPUèµ„æº
- å¯èƒ½æ— é™æœŸç­‰å¾…

---

#### 5. TIMED_WAITINGï¼ˆè¶…æ—¶ç­‰å¾…ï¼‰

```java
public class TimedWaitingExample {
    public static void main(String[] args) throws InterruptedException {
        Thread t1 = new Thread(() -> {
            try {
                Thread.sleep(5000); // è¿›å…¥TIMED_WAITINGçŠ¶æ€
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        });
        
        t1.start();
        Thread.sleep(100);
        
        System.out.println("t1çŠ¶æ€: " + t1.getState()); // TIMED_WAITING
    }
}
```

**è¿›å…¥TIMED_WAITINGçš„5ç§æ–¹å¼**ï¼š

1. **Thread.sleep(long millis)**ï¼šä¼‘çœ æŒ‡å®šæ—¶é—´
2. **Object.wait(long timeout)**ï¼šç­‰å¾…æŒ‡å®šæ—¶é—´
3. **Thread.join(long millis)**ï¼šç­‰å¾…çº¿ç¨‹ç»“æŸï¼Œæœ€å¤šç­‰å¾…æŒ‡å®šæ—¶é—´
4. **LockSupport.parkNanos(long nanos)**ï¼šæš‚åœæŒ‡å®šçº³ç§’
5. **LockSupport.parkUntil(long deadline)**ï¼šæš‚åœåˆ°æŒ‡å®šæ—¶é—´ç‚¹

**ç‰¹ç‚¹**ï¼š
- å¸¦è¶…æ—¶çš„ç­‰å¾…
- è¶…æ—¶åè‡ªåŠ¨è¿”å›RUNNABLE
- å¯è¢«ä¸­æ–­

---

#### 6. TERMINATEDï¼ˆç»ˆæ­¢ï¼‰

```java
Thread t1 = new Thread(() -> {
    System.out.println("æ‰§è¡Œå®Œæˆ");
});

t1.start();
t1.join(); // ç­‰å¾…t1ç»“æŸ

System.out.println("t1çŠ¶æ€: " + t1.getState()); // TERMINATED
```

**è¿›å…¥TERMINATEDçš„2ç§æ–¹å¼**ï¼š

1. **æ­£å¸¸ç»“æŸ**ï¼šrun()æ–¹æ³•æ‰§è¡Œå®Œæ¯•
2. **å¼‚å¸¸ç»“æŸ**ï¼šrun()æ–¹æ³•æŠ›å‡ºæœªæ•è·çš„å¼‚å¸¸

**ç‰¹ç‚¹**ï¼š
- çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸç»“æŸ
- ä¸å¯å†æ¬¡å¯åŠ¨ï¼ˆä¼šæŠ›å‡ºIllegalThreadStateExceptionï¼‰
- èµ„æºå·²é‡Šæ”¾

---

### 2.2 é—®é¢˜5ï¼šçº¿ç¨‹çŠ¶æ€å¦‚ä½•è½¬æ¢ï¼Ÿ

**å®Œæ•´çš„çŠ¶æ€è½¬æ¢å›¾**ï¼š

```
                    start()
        NEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> RUNNABLE
                                       â”‚
                                       â”‚ è·å¾—CPU
                                       â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚         Running (è¿è¡Œä¸­)          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚           â”‚           â”‚
        ç­‰å¾…synchronizedé”â”‚           â”‚sleep()    â”‚run()ç»“æŸ
                         â”‚           â”‚join()     â”‚å¼‚å¸¸é€€å‡º
                         â†“           â”‚wait()     â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”       â†“      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚BLOCKED â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚TERMINATED  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚WAITING â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚      â”‚æˆ–      â”‚
                    è·å¾—é”â”‚      â”‚TIMED_  â”‚
                         â”‚      â”‚WAITING â”‚
                         â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚           â”‚
                         â”‚    notify()â”‚
                         â”‚    è¶…æ—¶    â”‚
                         â”‚    ä¸­æ–­    â”‚
                         â†“           â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚         RUNNABLE (å°±ç»ª)           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®è½¬æ¢è¯´æ˜**ï¼š

1. **NEW â†’ RUNNABLE**ï¼šè°ƒç”¨`start()`
2. **RUNNABLE â†’ BLOCKED**ï¼šç­‰å¾…synchronizedé”
3. **RUNNABLE â†’ WAITING**ï¼šè°ƒç”¨wait()/join()/park()
4. **RUNNABLE â†’ TIMED_WAITING**ï¼šè°ƒç”¨sleep()/wait(timeout)/join(timeout)
5. **BLOCKED â†’ RUNNABLE**ï¼šè·å¾—é”
6. **WAITING â†’ RUNNABLE**ï¼šè¢«notify()/notifyAll()/unpark()
7. **TIMED_WAITING â†’ RUNNABLE**ï¼šè¶…æ—¶æˆ–è¢«å”¤é†’
8. **RUNNABLE â†’ TERMINATED**ï¼šrun()æ–¹æ³•ç»“æŸ

---

### 2.3 é—®é¢˜6ï¼šä¸ºä»€ä¹ˆæœ‰BLOCKEDå’ŒWAITINGä¸¤ç§ç­‰å¾…çŠ¶æ€ï¼Ÿ

**æ ¸å¿ƒåŒºåˆ«**ï¼š

| ç»´åº¦ | BLOCKED | WAITING/TIMED_WAITING |
|------|---------|----------------------|
| **åŸå› ** | ç­‰å¾…è·å–synchronizedé” | ä¸»åŠ¨è°ƒç”¨wait/join/parkç­‰æ–¹æ³• |
| **ä¸»åŠ¨æ€§** | è¢«åŠ¨ç­‰å¾… | ä¸»åŠ¨ç­‰å¾… |
| **å”¤é†’æ–¹å¼** | è‡ªåŠ¨ï¼ˆè·å¾—é”ï¼‰ | éœ€è¦å…¶ä»–çº¿ç¨‹å”¤é†’æˆ–è¶…æ—¶ |
| **é”çŠ¶æ€** | æœªæŒæœ‰é” | å¯èƒ½æŒæœ‰é”ï¼ˆwaitä¼šé‡Šæ”¾ï¼‰ |
| **CPUå ç”¨** | ä¸å ç”¨ | ä¸å ç”¨ |

**ä¸ºä»€ä¹ˆè¦åŒºåˆ†ï¼Ÿ**

1. **è¯­ä¹‰æ¸…æ™°**ï¼šBLOCKEDè¡¨ç¤ºç«äº‰èµ„æºï¼ŒWAITINGè¡¨ç¤ºç­‰å¾…æ¡ä»¶
2. **ç›‘æ§è¯Šæ–­**ï¼šå¯ä»¥å¿«é€Ÿå®šä½é—®é¢˜ï¼ˆæ­»é” vs é€»è¾‘ç­‰å¾…ï¼‰
3. **æ€§èƒ½åˆ†æ**ï¼šåŒºåˆ†é”ç«äº‰å’Œä¸šåŠ¡ç­‰å¾…

**ç¤ºä¾‹å¯¹æ¯”**ï¼š

```java
// BLOCKEDï¼šç­‰å¾…é”
synchronized (lock) {
    // çº¿ç¨‹åœ¨è¿™é‡Œå¯èƒ½BLOCKED
    doSomething();
}

// WAITINGï¼šä¸»åŠ¨ç­‰å¾…
synchronized (lock) {
    lock.wait(); // ä¸»åŠ¨è¿›å…¥WAITING
}
```

---

## 3. çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼

### 3.1 é—®é¢˜7ï¼šåˆ›å»ºçº¿ç¨‹æœ‰å“ªäº›æ–¹å¼ï¼Ÿå„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ

#### æ–¹å¼1ï¼šç»§æ‰¿Threadç±»

```java
public class MyThread extends Thread {
    @Override
    public void run() {
        System.out.println("çº¿ç¨‹æ‰§è¡Œ: " + Thread.currentThread().getName());
    }
    
    public static void main(String[] args) {
        MyThread t1 = new MyThread();
        t1.start();
    }
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… ä»£ç ç®€å•ï¼Œæ˜“äºç†è§£
- âœ… å¯ä»¥ç›´æ¥ä½¿ç”¨Threadç±»çš„æ–¹æ³•

**ç¼ºç‚¹**ï¼š
- âŒ Javaå•ç»§æ‰¿é™åˆ¶ï¼Œæ— æ³•ç»§æ‰¿å…¶ä»–ç±»
- âŒ è€¦åˆåº¦é«˜ï¼Œä¸ç¬¦åˆç»„åˆä¼˜äºç»§æ‰¿åŸåˆ™
- âŒ æ— æ³•è¿”å›ç»“æœ

---

#### æ–¹å¼2ï¼šå®ç°Runnableæ¥å£

```java
public class MyRunnable implements Runnable {
    @Override
    public void run() {
        System.out.println("çº¿ç¨‹æ‰§è¡Œ: " + Thread.currentThread().getName());
    }
    
    public static void main(String[] args) {
        Thread t1 = new Thread(new MyRunnable());
        t1.start();
    }
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… é¿å…å•ç»§æ‰¿é™åˆ¶
- âœ… ä»£ç è§£è€¦ï¼Œä»»åŠ¡å’Œçº¿ç¨‹åˆ†ç¦»
- âœ… å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹å…±äº«

**ç¼ºç‚¹**ï¼š
- âŒ ä»£ç ç¨å¾®å¤æ‚ï¼ˆéœ€è¦åˆ›å»ºThreadå¯¹è±¡ï¼‰
- âŒ æ— æ³•è¿”å›ç»“æœ

---

#### æ–¹å¼3ï¼šå®ç°Callableæ¥å£

```java
public class MyCallable implements Callable<Integer> {
    @Override
    public Integer call() throws Exception {
        System.out.println("çº¿ç¨‹æ‰§è¡Œ: " + Thread.currentThread().getName());
        return 42;
    }
    
    public static void main(String[] args) throws Exception {
        FutureTask<Integer> task = new FutureTask<>(new MyCallable());
        Thread t1 = new Thread(task);
        t1.start();
        
        // è·å–è¿”å›å€¼ï¼ˆä¼šé˜»å¡ï¼‰
        Integer result = task.get();
        System.out.println("è¿”å›å€¼: " + result);
    }
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… å¯ä»¥è¿”å›ç»“æœ
- âœ… å¯ä»¥æŠ›å‡ºå¼‚å¸¸
- âœ… æ”¯æŒFutureæœºåˆ¶

**ç¼ºç‚¹**ï¼š
- âŒ ä»£ç è¾ƒå¤æ‚
- âŒ get()æ–¹æ³•ä¼šé˜»å¡

---

#### æ–¹å¼4ï¼šä½¿ç”¨Lambdaè¡¨è¾¾å¼ï¼ˆJDK 8+ï¼‰

```java
public class LambdaThread {
    public static void main(String[] args) {
        // Runnable
        Thread t1 = new Thread(() -> {
            System.out.println("Lambdaçº¿ç¨‹: " + Thread.currentThread().getName());
        });
        t1.start();
        
        // Callable
        FutureTask<Integer> task = new FutureTask<>(() -> {
            return 42;
        });
        new Thread(task).start();
    }
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… ä»£ç ç®€æ´
- âœ… å‡½æ•°å¼ç¼–ç¨‹é£æ ¼

---

#### æ–¹å¼5ï¼šä½¿ç”¨çº¿ç¨‹æ± ï¼ˆæ¨èï¼‰

```java
public class ThreadPoolExample {
    public static void main(String[] args) {
        ExecutorService executor = Executors.newFixedThreadPool(5);
        
        // æäº¤Runnable
        executor.execute(() -> {
            System.out.println("çº¿ç¨‹æ± æ‰§è¡Œ");
        });
        
        // æäº¤Callable
        Future<Integer> future = executor.submit(() -> {
            return 42;
        });
        
        executor.shutdown();
    }
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… çº¿ç¨‹å¤ç”¨ï¼Œæ€§èƒ½é«˜
- âœ… ç»Ÿä¸€ç®¡ç†ï¼Œæ˜“äºæ§åˆ¶
- âœ… æ”¯æŒå®šæ—¶ã€å‘¨æœŸä»»åŠ¡

**ç¼ºç‚¹**ï¼š
- âŒ é…ç½®å¤æ‚
- âŒ éœ€è¦ç†è§£çº¿ç¨‹æ± åŸç†

---

### 3.2 é—®é¢˜8ï¼šstart() vs run()ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**é”™è¯¯ç¤ºä¾‹**ï¼š

```java
Thread t1 = new Thread(() -> {
    System.out.println("å½“å‰çº¿ç¨‹: " + Thread.currentThread().getName());
});

t1.run(); // âŒ é”™è¯¯ï¼šç›´æ¥è°ƒç”¨run()
// è¾“å‡ºï¼šå½“å‰çº¿ç¨‹: mainï¼ˆåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼ï¼‰
```

**æ­£ç¡®ç¤ºä¾‹**ï¼š

```java
Thread t1 = new Thread(() -> {
    System.out.println("å½“å‰çº¿ç¨‹: " + Thread.currentThread().getName());
});

t1.start(); // âœ… æ­£ç¡®ï¼šè°ƒç”¨start()
// è¾“å‡ºï¼šå½“å‰çº¿ç¨‹: Thread-0ï¼ˆåœ¨æ–°çº¿ç¨‹ä¸­æ‰§è¡Œï¼ï¼‰
```

**æ ¸å¿ƒåŒºåˆ«**ï¼š

| ç»´åº¦ | start() | run() |
|------|---------|-------|
| **æ‰§è¡Œæ–¹å¼** | å¯åŠ¨æ–°çº¿ç¨‹æ‰§è¡Œ | åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œ |
| **è°ƒç”¨æ¬¡æ•°** | åªèƒ½è°ƒç”¨ä¸€æ¬¡ | å¯ä»¥å¤šæ¬¡è°ƒç”¨ |
| **çº¿ç¨‹çŠ¶æ€** | NEW â†’ RUNNABLE | ä¸æ”¹å˜çŠ¶æ€ |
| **åº•å±‚å®ç°** | è°ƒç”¨nativeæ–¹æ³•åˆ›å»ºçº¿ç¨‹ | æ™®é€šæ–¹æ³•è°ƒç”¨ |

**start()æ–¹æ³•åšäº†ä»€ä¹ˆï¼Ÿ**

```java
public synchronized void start() {
    // 1. æ£€æŸ¥çº¿ç¨‹çŠ¶æ€ï¼ˆä¸èƒ½é‡å¤å¯åŠ¨ï¼‰
    if (threadStatus != 0)
        throw new IllegalThreadStateException();
    
    // 2. å°†çº¿ç¨‹åŠ å…¥çº¿ç¨‹ç»„
    group.add(this);
    
    boolean started = false;
    try {
        // 3. è°ƒç”¨nativeæ–¹æ³•å¯åŠ¨çº¿ç¨‹
        start0();
        started = true;
    } finally {
        try {
            if (!started) {
                group.threadStartFailed(this);
            }
        } catch (Throwable ignore) {
        }
    }
}

// nativeæ–¹æ³•ï¼Œç”±JVMå®ç°
private native void start0();
```

**æµç¨‹å›¾**ï¼š

```
è°ƒç”¨start()
    â†“
æ£€æŸ¥çº¿ç¨‹çŠ¶æ€
    â†“
åŠ å…¥çº¿ç¨‹ç»„
    â†“
è°ƒç”¨start0()ï¼ˆnativeï¼‰
    â†“
JVMåˆ›å»ºæ–°çº¿ç¨‹
    â†“
æ–°çº¿ç¨‹è°ƒç”¨run()æ–¹æ³•
    â†“
run()æ‰§è¡Œå®Œæ¯•
    â†“
çº¿ç¨‹ç»ˆæ­¢
```

---

## 4. æ ¸å¿ƒé—®é¢˜æ€»ç»“

### Q1: ä¸ºä»€ä¹ˆéœ€è¦çº¿ç¨‹ï¼Ÿ
**A**: æé«˜ç¨‹åºå¹¶å‘æ€§ã€å……åˆ†åˆ©ç”¨CPUå’ŒIOèµ„æºã€æå‡å“åº”é€Ÿåº¦ã€å‘æŒ¥å¤šæ ¸ä¼˜åŠ¿ã€‚

### Q2: è¿›ç¨‹å’Œçº¿ç¨‹çš„æœ¬è´¨åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ
**A**: è¿›ç¨‹æ˜¯èµ„æºåˆ†é…å•ä½ï¼ˆç‹¬ç«‹å†…å­˜ï¼‰ï¼Œçº¿ç¨‹æ˜¯CPUè°ƒåº¦å•ä½ï¼ˆå…±äº«å†…å­˜ï¼‰ã€‚

### Q3: Javaçº¿ç¨‹æœ‰å“ª6ç§çŠ¶æ€ï¼Ÿ
**A**: NEWã€RUNNABLEã€BLOCKEDã€WAITINGã€TIMED_WAITINGã€TERMINATEDã€‚

### Q4: ä¸ºä»€ä¹ˆJavaæ²¡æœ‰åŒºåˆ†Readyå’ŒRunningçŠ¶æ€ï¼Ÿ
**A**: çº¿ç¨‹è°ƒåº¦ç”±OSæ§åˆ¶ï¼ŒJavaæ— æ³•ç²¾ç¡®çŸ¥é“çº¿ç¨‹æ˜¯å¦åœ¨CPUä¸Šè¿è¡Œã€‚

### Q5: BLOCKEDå’ŒWAITINGæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
**A**: BLOCKEDæ˜¯ç­‰å¾…synchronizedé”ï¼ˆè¢«åŠ¨ï¼‰ï¼ŒWAITINGæ˜¯ä¸»åŠ¨ç­‰å¾…ï¼ˆéœ€è¦å”¤é†’ï¼‰ã€‚

### Q6: åˆ›å»ºçº¿ç¨‹çš„æœ€ä½³æ–¹å¼æ˜¯ä»€ä¹ˆï¼Ÿ
**A**: å®ç°Runnable/Callableæ¥å£ï¼Œæˆ–ä½¿ç”¨çº¿ç¨‹æ± ï¼ˆæ¨èï¼‰ã€‚

### Q7: ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥è°ƒç”¨run()æ–¹æ³•ï¼Ÿ
**A**: run()åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œï¼Œstart()æ‰ä¼šåˆ›å»ºæ–°çº¿ç¨‹ã€‚

### Q8: çº¿ç¨‹å¯ä»¥é‡å¤å¯åŠ¨å—ï¼Ÿ
**A**: ä¸å¯ä»¥ï¼Œä¼šæŠ›å‡ºIllegalThreadStateExceptionã€‚

---

## ä¸‹ä¸€ç« é¢„å‘Š

ä¸‹ä¸€ç« æˆ‘ä»¬å°†æ·±å…¥å­¦ä¹ ï¼š

- **çº¿ç¨‹åä½œæœºåˆ¶**ï¼šsleepã€joinã€yieldã€wait/notify
- **æ¯ä¸ªæ–¹æ³•çš„å·¥ä½œåŸç†å’Œä½¿ç”¨åœºæ™¯**
- **å¸¸è§é™·é˜±å’Œæœ€ä½³å®è·µ**
- **ä¸çº¿ç¨‹æ± çš„å¯¹æ¯”**

è®©æˆ‘ä»¬ç»§ç»­æ·±å…¥ï¼ğŸš€
