# 01 反射基础原理

## 什么是反射

反射（Reflection）是 Java 语言的一个重要特性，它允许程序在运行时检查和操作类、接口、字段和方法的信息，即使在编译时不知道它们的名称。

## 反射的核心概念

### Class 对象
- 每个类在 JVM 中都有一个对应的 `Class` 对象
- `Class` 对象包含了类的所有元信息（字段、方法、构造器等）
- 是反射操作的入口点

### 获取 Class 对象的三种方式

```java
// 1. 通过 .class 语法（编译时已知类型）
Class<?> clazz1 = Person.class;

// 2. 通过 Class.forName()（运行时动态加载）
Class<?> clazz2 = Class.forName("com.fragment.core.reflection.Person");

// 3. 通过对象的 getClass()（已有实例对象）
Person person = new Person();
Class<?> clazz3 = person.getClass();
```

## JVM 中的反射实现

### 类加载过程
1. **加载（Loading）**：将 .class 文件读入内存
2. **链接（Linking）**：验证、准备、解析
3. **初始化（Initialization）**：执行静态初始化代码

### Method Area 存储
- 类的元数据存储在方法区（Java 8+ 为 Metaspace）
- 包括类结构、字段信息、方法信息等
- `Class` 对象作为访问这些元数据的接口

### 反射调用的底层机制
- **本地方法调用**：前几次调用使用 JNI
- **字节码生成**：频繁调用后 JVM 会生成优化的字节码
- **内联优化**：HotSpot 可能将反射调用内联化

## 反射的应用场景

1. **框架开发**：Spring、Hibernate 等框架大量使用反射
2. **序列化/反序列化**：JSON、XML 处理
3. **动态代理**：AOP 实现
4. **配置驱动**：根据配置文件动态创建对象
5. **测试工具**：访问私有成员进行单元测试

## 反射的优缺点

### 优点
- **灵活性**：运行时动态操作类和对象
- **通用性**：编写通用的框架和工具
- **解耦**：减少编译时依赖

### 缺点
- **性能开销**：比直接调用慢 10-100 倍
- **安全风险**：可以绕过访问控制
- **代码复杂性**：难以理解和维护
- **编译时检查缺失**：错误在运行时才能发现

## 示例代码位置

- `BasicReflectionDemo.java`：基础反射操作演示
- `Person.java`：用于演示的 POJO 类
