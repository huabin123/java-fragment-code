# 02 字段和方法反射

## 字段反射操作

### 获取字段信息

```java
Class<?> clazz = Person.class;

// 获取所有公共字段（包括继承的）
Field[] publicFields = clazz.getFields();

// 获取所有声明的字段（不包括继承的）
Field[] declaredFields = clazz.getDeclaredFields();

// 获取特定字段
Field nameField = clazz.getDeclaredField("name");
```

### 字段访问控制

```java
Field privateField = clazz.getDeclaredField("name");
privateField.setAccessible(true); // 绕过访问控制

// 获取字段值
Object value = privateField.get(instance);

// 设置字段值
privateField.set(instance, newValue);
```

### 静态字段操作

```java
Field staticField = clazz.getDeclaredField("species");
staticField.setAccessible(true);

// 静态字段操作时实例参数传 null
Object staticValue = staticField.get(null);
staticField.set(null, newValue);
```

## 方法反射操作

### 获取方法信息

```java
// 获取所有公共方法（包括继承的）
Method[] publicMethods = clazz.getMethods();

// 获取所有声明的方法（不包括继承的）
Method[] declaredMethods = clazz.getDeclaredMethods();

// 获取特定方法（需要指定参数类型）
Method method = clazz.getMethod("greet", String.class);
Method privateMethod = clazz.getDeclaredMethod("privateMethod", String.class);
```

### 方法调用

```java
Method method = clazz.getMethod("greet");
Object result = method.invoke(instance, args);

// 静态方法调用
Method staticMethod = clazz.getMethod("getSpecies");
Object result = staticMethod.invoke(null);

// 私有方法调用
Method privateMethod = clazz.getDeclaredMethod("privateMethod", String.class);
privateMethod.setAccessible(true);
privateMethod.invoke(instance, "参数");
```

### 方法重载处理

```java
// 无参方法
Method greet1 = clazz.getMethod("greet");

// 带参方法
Method greet2 = clazz.getMethod("greet", String.class);
```

## 修饰符检查

### 使用 Modifier 类

```java
import java.lang.reflect.Modifier;

Field field = clazz.getDeclaredField("name");
int modifiers = field.getModifiers();

boolean isPrivate = Modifier.isPrivate(modifiers);
boolean isStatic = Modifier.isStatic(modifiers);
boolean isFinal = Modifier.isFinal(modifiers);
```

### 常用修饰符检查

- `Modifier.isPublic()`
- `Modifier.isPrivate()`
- `Modifier.isProtected()`
- `Modifier.isStatic()`
- `Modifier.isFinal()`
- `Modifier.isAbstract()`
- `Modifier.isSynchronized()`

## 异常处理

### 常见异常类型

- `NoSuchFieldException`：字段不存在
- `NoSuchMethodException`：方法不存在
- `IllegalAccessException`：访问权限不足
- `IllegalArgumentException`：参数类型不匹配
- `InvocationTargetException`：方法执行时抛出异常

### 异常处理示例

```java
try {
    Method method = clazz.getMethod("validateAge");
    method.invoke(person);
} catch (InvocationTargetException e) {
    // 获取实际抛出的异常
    Throwable cause = e.getCause();
    System.out.println("方法执行异常: " + cause.getMessage());
}
```

## 性能优化建议

1. **缓存反射对象**：避免重复获取 Method、Field 对象
2. **批量操作**：一次性获取多个字段/方法
3. **避免 setAccessible**：尽量使用公共 API
4. **考虑替代方案**：MethodHandle、字节码生成等

## 示例代码位置

- `BasicReflectionDemo.java`：完整的字段和方法反射演示
- `Person.java`：包含各种类型字段和方法的示例类
